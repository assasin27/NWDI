<!DOCTYPE html>
<html>
<head>
  <title>Inspect Database Schema</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
    .table { margin: 20px 0; border-collapse: collapse; width: 100%; }
    .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .table th { background-color: #f2f2f2; }
    .table tr:nth-child(even) { background-color: #f9f9f9; }
    .error { color: red; margin: 10px 0; }
    .success { color: green; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Database Schema Inspector</h1>
  
  <div>
    <h2>Tables</h2>
    <div id="tablesList">Loading tables...</div>
  </div>
  
  <div id="tableDetails" style="margin-top: 30px; display: none;">
    <h2>Table: <span id="tableName"></span></h2>
    <h3>Columns</h3>
    <table class="table" id="columnsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Nullable</th>
          <th>Default</th>
          <th>Primary Key</th>
        </tr>
      </thead>
      <tbody id="columnsList"></tbody>
    </table>
    
    <h3>Sample Data (first 5 rows)</h3>
    <div id="sampleData"></div>
  </div>

  <script>
    // Supabase configuration
    const supabaseUrl = 'https://lzjhjecktllltkizgwnr.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6amhqZWNrdGxsbHRraXpnd25yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1OTg0NTUsImV4cCI6MjA2ODE3NDQ1NX0.MW3fIJA4_8nnMnC-__8aloqH1tBo4IIpmA_2LPqDxug';
    
    // Initialize Supabase
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    
    // Get list of tables
    async function loadTables() {
      const tablesList = document.getElementById('tablesList');
      
      try {
        // First try to get tables using information_schema
        const { data: tables, error } = await supabase
          .from('information_schema.tables')
          .select('table_name')
          .eq('table_schema', 'public');
          
        if (error) throw error;
        
        if (tables && tables.length > 0) {
          const tableNames = tables.map(t => t.table_name).filter(name => !name.startsWith('pg_'));
          tablesList.innerHTML = `
            <ul>
              ${tableNames.map(name => 
                `<li>
                  <a href="#" class="table-link" data-table="${name}">${name}</a>
                </li>`
              ).join('')}
            </ul>
          `;
          
          // Add click handlers for table links
          document.querySelectorAll('.table-link').forEach(link => {
            link.addEventListener('click', (e) => {
              e.preventDefault();
              loadTableDetails(link.dataset.table);
            });
          });
          
        } else {
          tablesList.innerHTML = 'No tables found in the public schema.';
        }
      } catch (error) {
        tablesList.innerHTML = `Error loading tables: ${error.message}`;
        console.error('Error loading tables:', error);
      }
    }
    
    // Load table details
    async function loadTableDetails(tableName) {
      const tableDetails = document.getElementById('tableDetails');
      const tableNameEl = document.getElementById('tableName');
      const columnsList = document.getElementById('columnsList');
      const sampleDataEl = document.getElementById('sampleData');
      
      tableNameEl.textContent = tableName;
      tableDetails.style.display = 'block';
      columnsList.innerHTML = '<tr><td colspan="5">Loading columns...</td></tr>';
      sampleDataEl.innerHTML = 'Loading sample data...';
      
      try {
        // Get column information
        const { data: columns, error: columnsError } = await supabase
          .from('information_schema.columns')
          .select('*')
          .eq('table_schema', 'public')
          .eq('table_name', tableName)
          .order('ordinal_position');
          
        if (columnsError) throw columnsError;
        
        if (columns && columns.length > 0) {
          columnsList.innerHTML = columns.map(col => `
            <tr>
              <td>${col.column_name}</td>
              <td>${col.data_type}</td>
              <td>${col.is_nullable === 'YES' ? 'Yes' : 'No'}</td>
              <td>${col.column_default || 'NULL'}</td>
              <td>${col.column_name === 'id' ? 'Yes' : 'No'}</td>
            </tr>
          `).join('');
          
          // Try to get sample data
          try {
            const { data: rows, error: dataError } = await supabase
              .from(tableName)
              .select('*')
              .limit(5);
              
            if (dataError) throw dataError;
            
            if (rows && rows.length > 0) {
              sampleDataEl.innerHTML = `
                <pre>${JSON.stringify(rows, null, 2)}</pre>
              `;
            } else {
              sampleDataEl.innerHTML = 'No data found in this table.';
            }
          } catch (dataError) {
            sampleDataEl.innerHTML = `Error loading data: ${dataError.message}`;
            console.error('Error loading data:', dataError);
          }
          
        } else {
          columnsList.innerHTML = '<tr><td colspan="5">No columns found for this table.</td></tr>';
        }
      } catch (error) {
        columnsList.innerHTML = `<tr><td colspan="5">Error loading columns: ${error.message}</td></tr>`;
        console.error('Error loading table details:', error);
      }
    }
    
    // Load tables when page loads
    document.addEventListener('DOMContentLoaded', loadTables);
  </script>
</body>
</html>
